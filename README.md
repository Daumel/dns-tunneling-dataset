# DNS tunneling dataset

The dataset, which you can download from [Kaggle](https://www.kaggle.com/datasets/daumel/dns-tunneling-dataset), is
provided in CSV format and includes both benign DNS traffic and malicious DNS tunneling traffic. Each
row
represents a query-response pair and consists of 45 attributes. Below is an example illustrating the
structure of the dataset:

| flow_id                                                                 | timestamp                  | src_ip          | src_port | dst_ip        | dst_port | duration | total_bytes | receiving_bytes | sending_bytes | packets_rate | packets_len_rate | min_packets_len | max_packets_len | mean_packets_len | standard_deviation_packets_len | variance_packets_len | coefficient_of_variation_packets_len | dns_domain_name                                   | dns_top_level_domain | dns_second_level_domain | dns_domain_name_length | dns_subdomain_name_length | uni_gram_domain_name                              | bi_gram_domain_name                               | tri_gram_domain_name                              | numerical_percentage | character_distribution                            | character_entropy | max_continuous_numeric_len | max_continuous_alphabet_len | max_continuous_consonants_len | max_continuous_same_alphabet_len | vowels_consonant_ratio | conv_freq_vowels_consonants | distinct_ttl_values | ttl_values_min | ttl_values_max | ttl_values_mean | ttl_values_mode | ttl_values_median | distinct_A_records | ans_resource_record_type | ans_resource_record_class | label     |
|-------------------------------------------------------------------------|----------------------------|-----------------|----------|---------------|----------|----------|-------------|-----------------|---------------|--------------|------------------|-----------------|-----------------|------------------|--------------------------------|----------------------|--------------------------------------|---------------------------------------------------|----------------------|-------------------------|------------------------|---------------------------|---------------------------------------------------|---------------------------------------------------|---------------------------------------------------|----------------------|---------------------------------------------------|-------------------|----------------------------|-----------------------------|-------------------------------|----------------------------------|------------------------|-----------------------------|---------------------|----------------|----------------|-----------------|-----------------|-------------------|--------------------|--------------------------|---------------------------|-----------|
| 2023-08-05 09:03:40.862988_192.168.68.62_49517_192.168.68.1_53_11349    | 2023-08-05 09:03:40.862988 | 192.168.68.62   | 49517    | 192.168.68.1  | 53       | 0.38218  | 178         | 105             | 73            | 5.23314      | 465.74915        | 73              | 105             | 89.0             | 16.0                           | 256.0                | 0.17978                              | athomenet.com.                                    | com                  | athomenet.com           | 14                     | 0                         | ['a', 't', 'h', 'o', 'm', 'e', 'n', 'e', 't', ... | ['at', 'th', 'ho', 'om', 'me', 'en', 'ne', 'et... | ['ath', 'tho', 'hom', 'ome', 'men', 'ene', 'ne... | 0.0                  | {'o': 2, 'm': 2, 'c': 1, 'a': 1, 'n': 1, 't': ... | 3.093069          | 0                          | 9                           | 2                             | 1                                | 0.714286               | 0.642857                    | 1                   | 300            | 300            | 300.0           | 300.0           | 300.0             | 2                  | [1, 1]                   | [1, 1]                    | Benign    |
| 2023-09-04 13:26:18.270548_192.168.117.128_54174_192.168.117.2_53_30922 | 2023-09-04 13:26:18.270548 | 192.168.117.128 | 54174    | 192.168.117.2 | 53       | 0.31352  | 345         | 181             | 164           | 6.37922      | 1100.41596       | 164             | 181             | 172.5            | 8.5                            | 72.25                | 0.04928                              | dIUIAANBWVVAAAQAGDCZ4BKBVAHAKQNICQ64AAFXGWPC76... | de                   | daumel.de               | 105                    | 63                        | ['d', 'I', 'U', 'I', 'A', 'A', 'N', 'B', 'W', ... | ['dI', 'IU', 'UI', 'IA', 'AA', 'AN', 'NB', 'BW... | ['dIU', 'IUI', 'UIA', 'IAA', 'AAN', 'ANB', 'NB... | 0.123810             | {'Q': 5, 'I': 3, '7': 3, 'Y': 2, 'Z': 1, 'm': ... | 4.607292          | 4                          | 20                          | 3                             | 3                                | 0.500000               | 0.047619                    | 1                   | 5              | 5              | 5.0             | 5.0             | 5.0               | 0                  | [5]                      | [1]                       | Malicious |

The dataset comprises 711,006 benign samples and 243,872 malicious samples. The malicious samples were generated using
seven different DNS tunneling tools, including dnscat2, cobaltstrike, and others.

## Why was the dataset generated?

There is a notable scarcity of publicly available DNS tunneling datasets that are qualitative and provided in an
analyzable format. Most existing CSV datasets exhibit one or more of the following issues:

- The DNS tunneling traffic was generated using only one or a few tunneling tools, resulting in malicious samples that
  do not represent a diverse range of attack patterns.
- There are limited attributes per sample, which restricts the extensive analysis of the behaviors of DNS tunneling
  tools.
- The datasets contain inaccurate data, including erroneous labeling (e.g., benign samples labeled as malicious).
- There is insufficient explanation regarding the dataset's creation process, including details about the tunneling
  tools that were utilized.

This dataset aims to address these challenges.

## How was the dataset generated?

The dataset is based on the [DNS traffic](https://github.com/ggyggy666/DNS-Tunnel-Datasets) created by Gao et al.,
which was utilized in the
article [GraphTunnel: Robust DNS Tunnel Detection Based on DNS Recursive Resolution Graph](https://ieeexplore.ieee.org/document/10636232).
One of the key strengths of this DNS traffic is that it was generated using a variety of DNS tunneling tools,
thereby addressing the issue of limited attack pattern diversity found in other datasets. Nevertheless, I identified an
issue
with the use of the domain name ggy666.tk. Its artificial nature has the potential to skew feature metrics such as
entropy or the numerical character percentage. To address this and maintain a more realistic character distribution, I
developed a Python script utilizing Scapy to systematically replace ggy666.tk with the more natural domain daumel.de
throughout the PCAP files.

The DNS traffic, originally captured in PCAP format, was converted into CSV format using the
tool [ALFlowLyzer](https://github.com/ahlashkari/ALFlowLyzer/tree/main).
ALFlowLyzer is a Python open-source project to extract application layer features from network traffic. It was developed
by Shafi et al. to generate
the [BCCC-CIC-Bell-DNS-2024](https://www.yorku.ca/research/bccc/ucs-technical/cybersecurity-datasets-cds/)
dataset. Further details can be found in their article titled [Unveiling malicious DNS behavior profiling and generating
benchmark dataset through application layer traffic analysis](https://www.sciencedirect.com/science/article/pii/S0045790624003641)

Each row in the CSV files generated by ALFlowLyzer represents a bidirectional DNS flow, with the first packet
determining the forward (source-to-destination) and backward (destination-to-source) directions. The key identifier for
a DNS flow is the transaction ID found in the DNS header. Consequently, if the same transaction ID is used multiple
times within a short time frame, a single row may correspond to multiple query-response pairs.

This situation poses a problem, as multiple query-response pairs sharing the same transaction ID within a short time
frame usually occur randomly and are unrelated to each other. This also applies to DNS tunneling malware, which
typically imitates legitimate traffic by generating separate queries with random transaction IDs. To resolve this, I
decided to
remove all rows where a DNS flow includes more than one request and response. This approach ensures that each row
accurately reflects a unique
query-response interaction.

To further enhance the quality of the dataset, I have carried out additional data cleaning procedures. These
include:

- Removing duplicate query-response pairs
- Removing query-response pairs where data was incorrectly extracted due to parsing errors by ALFlowLyzer
- Removing query-response pairs that exhibited erroneous or incomplete responses due to network or nameserver issues

# What is the meaning of each attribute?

| **No.** | **Attribute**                            | **Description**                                                                                                                                                                                                                                                                                                                  |
|---------|------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1       | **flow_id**                              | The identifier of the DNS flow, structured as follows: Timestamp_SrcIP_SrcPort_DstIP_DstPort_TransactionID.                                                                                                                                                                                                                      |
| 2       | **timestamp**                            | When the DNS request was sent.                                                                                                                                                                                                                                                                                                   |
| 3       | **src_ip**                               | The IP address from which the DNS request was sent.                                                                                                                                                                                                                                                                              |
| 4       | **src_port**                             | The port from which the DNS request was sent.                                                                                                                                                                                                                                                                                    |
| 5       | **dst_ip**                               | The IP address to which the DNS request was sent.                                                                                                                                                                                                                                                                                |
| 6       | **dst_port**                             | The port to which the DNS request was sent.                                                                                                                                                                                                                                                                                      |
| 7       | **duration**                             | The number of seconds between the DNS request and the DNS response.                                                                                                                                                                                                                                                              |
| 8       | **total_bytes**                          | The total size of the DNS request and its corresponding DNS response, measured in bytes.                                                                                                                                                                                                                                         |
| 9       | **receiving_bytes**                      | The size of the DNS response in bytes.                                                                                                                                                                                                                                                                                           |
| 10      | **sending_bytes**                        | The size of the DNS request in bytes.                                                                                                                                                                                                                                                                                            |
| 11      | **packets_rate**                         | The rate at which DNS packets are sent or received during the DNS flow. A higher packets rate means that the DNS request and response were exchanged in a shorter timeframe, suggesting fast communication. This metric is calculated by dividing the number of packets by the duration of the DNS flow: 2 / duration.           |
| 12      | **packets_len_rate**                     | The rate at which the total size of DNS packets is sent or received during the DNS flow. A higher packets_len_rate means that a larger amount of data was transmitted relative to the duration. This metric is calculated by dividing the total size of the DNS packets by the duration of the DNS flow: total_bytes / duration. |
| 13      | **min_packets_len**                      | The size in bytes of the smallest packet within the DNS flow.                                                                                                                                                                                                                                                                    |
| 14      | **max_packets_len**                      | The size in bytes of the largest packet within the DNS flow.                                                                                                                                                                                                                                                                     |
| 15      | **mean_packets_len**                     | The average size in bytes of the packets within the DNS flow.                                                                                                                                                                                                                                                                    |
| 16      | **standard_deviation_packets_len**       | The standard deviation of packet sizes in the DNS flow.                                                                                                                                                                                                                                                                          |
| 17      | **variance_packets_len**                 | The variance of packet sizes in the DNS flow.                                                                                                                                                                                                                                                                                    |
| 18      | **coefficient_of_variation_packets_len** | The coefficient of variation of packet sizes in the DNS flow. This metric is calculated by dividing the standard deviation of packet sizes by the average packet size: standard_deviation_packets_len / mean_packets_len.                                                                                                        |
| 19      | **dns_domain_name**                      | The domain name for which information is being queried.                                                                                                                                                                                                                                                                          |
| 20      | **dns_top_level_domain**                 | The top-level domain of the queried domain name.                                                                                                                                                                                                                                                                                 |
| 21      | **dns_second_level_domain**              | The second-level domain (including the first-level domain) of the queried domain name.                                                                                                                                                                                                                                           |
| 22      | **dns_domain_name_length**               | The length of the domain name (including the period at the end, which signifies the root level), measured in characters.                                                                                                                                                                                                         |
| 23      | **dns_subdomain_name_length**            | The length of the first subdomain when read from left to right.                                                                                                                                                                                                                                                                  |
| 24      | **uni_gram_domain_name**                 | The unigram of the domain name.                                                                                                                                                                                                                                                                                                  |
| 25      | **bi_gram_domain_name**                  | The bigram of the domain name.                                                                                                                                                                                                                                                                                                   |
| 26      | **tri_gram_domain_name**                 | The trigram of the domain name.                                                                                                                                                                                                                                                                                                  |
| 27      | **numerical_percentage**                 | The percentage of numeric characters in the domain name relative to its total length. This metric is calculated by dividing the number of digits in the domain name by its length: number of digits in the domain name / dns_domain_name_length.                                                                                 |
| 28      | **character_distribution**               | The frequency distribution of individual characters in the domain name. This attribute outputs the number of occurrences of each character in the domain name as a dictionary, where the keys are the characters and the values are their frequencies.                                                                           |
| 29      | **character_entropy**                    | The entropy of the characters in the domain name.                                                                                                                                                                                                                                                                                |
| 30      | **max_continuous_numeric_len**           | The length of the longest continuous sequence of digits in the domain name.                                                                                                                                                                                                                                                      |
| 31      | **max_continuous_alphabet_len**          | The length of the longest continuous sequence of alphabetic characters in the domain name.                                                                                                                                                                                                                                       |
| 32      | **max_continuous_consonants_len**        | The length of the longest continuous sequence of consonants in the domain name.                                                                                                                                                                                                                                                  |
| 33      | **max_continuous_same_alphabet_len**     | The length of the longest continuous sequence of identical letters in the domain name.                                                                                                                                                                                                                                           |
| 34      | **vowels_consonant_ratio**               | The ratio of vowels to consonants in the domain name.                                                                                                                                                                                                                                                                            |
| 35      | **conv_freq_vowels_consonants**          | The relative frequency of alternating vowels and consonants in the domain name. This metric is calculated by dividing the number of occurrences of alternating letters (vowel followed by consonant or vice versa) by the total length of the domain name.                                                                       |
| 36      | **distinct_ttl_values**                  | The number of distinct TTL values present in the resource records of the DNS flow.                                                                                                                                                                                                                                               |
| 37      | **ttl_values_min**                       | The smallest TTL value among the resource records in the DNS flow.                                                                                                                                                                                                                                                               |
| 38      | **ttl_values_max**                       | The largest TTL value among the resource records in the DNS flow.                                                                                                                                                                                                                                                                |
| 39      | **ttl_values_mean**                      | The average TTL value among the resource records in the DNS flow.                                                                                                                                                                                                                                                                |
| 40      | **ttl_values_mode**                      | The TTL value that occurs most frequently among the resource records in the DNS flow.                                                                                                                                                                                                                                            |
| 41      | **ttl_values_median**                    | The median of the TTL values among the resource records in the DNS flow.                                                                                                                                                                                                                                                         |
| 42      | **distinct_A_records**                   | The number of distinct resource records of type A present in the DNS flow.                                                                                                                                                                                                                                                       |
| 43      | **ans_resource_record_type**             | The types of resource records in the answer section.                                                                                                                                                                                                                                                                             |
| 44      | **ans_resource_record_class**            | The classes of resource records in the answer section.                                                                                                                                                                                                                                                                           |
| 45      | **label**                                | Indicates whether the DNS flow is classified as "Malicious" or "Benign."                                                                                                                                                                                                                                                         |
